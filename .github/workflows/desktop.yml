# .github/workflows/crd-ubuntu.yml
name: Ubuntu Minimal Desktop + CRD

on:
  workflow_dispatch:
    inputs:
      crd_auth_command:
        description: 'Paste CRD auth command (copied from https://remotedesktop.google.com/headless)'
        required: true
        type: string

jobs:
  setup-vps:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 tiáº¿ng
    steps:
      - name: Cáº­p nháº­t APT vÃ  cÃ i Ubuntu Desktop tá»‘i giáº£n
        run: |
          sudo apt update
          sudo apt install -y ubuntu-desktop-minimal gnome-terminal dbus-x11

      - name: CÃ i Chrome Remote Desktop
        run: |
          sudo wget https://dl.google.com/linux/direct/chrome-remote-desktop_current_amd64.deb
          sudo apt install ./chrome-remote-desktop_current_amd64.deb -y

      - name: Cáº¥u hÃ¬nh GNOME cho CRD
        run: |
          sudo bash -c 'echo "exec gnome-session" > /etc/chrome-remote-desktop-session'
          sudo usermod -a -G chrome-remote-desktop $USER

      - name: KÃ­ch hoáº¡t CRD vá»›i auth command
        run: |
          echo "${{ github.event.inputs.crd_auth_command }} --pin=123456" > crd.sh
          chmod +x crd.sh
          ./crd.sh

      - name: Khá»Ÿi Ä‘á»™ng láº¡i CRD service
        run: |
          sudo systemctl enable chrome-remote-desktop@$USER
          sudo systemctl restart chrome-remote-desktop@$USER

      - name: Keep Alive Ä‘á»ƒ giá»¯ káº¿t ná»‘i CRD
        run: |
          nohup bash -c 'while true; do echo "ğŸŸ¢ CRD Keep Alive Ping: $(date)"; sleep 300; done' > keepalive.log 2>&1 &

      - name: Giá»¯ runner sá»‘ng 6 giá»
        run: |
          echo "ğŸ•’ Giá»¯ runner sá»‘ng tá»‘i Ä‘a 6 tiáº¿ng..."
          end=$((SECONDS+21600))
          while [ $SECONDS -lt $end ]; do
            echo "â±ï¸ Runner váº«n hoáº¡t Ä‘á»™ng... $(date)"
            sleep 300
          done
